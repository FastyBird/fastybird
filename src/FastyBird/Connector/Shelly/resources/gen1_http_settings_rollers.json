{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "device": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "description": "Device model identifier",
          "enum": [
            "SHSW-21",
            "SHSW-25"
          ]
        }
      },
      "required": [
        "type"
      ]
    },
    "mode": {
      "type": "string",
      "enum": [
        "relay",
        "roller"
      ],
      "default": "relay"
    }
  },
  "required": [
    "device"
  ],
  "allOf": [
    {
      "if": {
        "properties": {
          "mode": {
            "enum": [
              "roller"
            ]
          }
        }
      },
      "then": {
        "properties": {
          "rollers": {
            "type": "array",
            "uniqueItems": true,
            "items": {
              "type": "object",
              "properties": {
                "maxtime": {
                  "type": "number",
                  "description": "The maximum time needed for the mechanism to completely open or close, seconds"
                },
                "maxtime_open": {
                  "type": "number",
                  "description": "The maximum time needed for the mechanism to completely open, seconds"
                },
                "maxtime_close": {
                  "type": "number",
                  "description": "The maximum time needed for the mechanism to completely close, seconds"
                },
                "default_state": {
                  "type": "string",
                  "description": "One of stop, open, close. This parameters determines the behavior on power-on",
                  "enum": [
                    "stop",
                    "open",
                    "close"
                  ]
                },
                "swap": {
                  "type": "boolean",
                  "description": "Whether to swap OPEN and CLOSE directions"
                },
                "swap_inputs": {
                  "type": "boolean",
                  "description": "Whether inputs are swapped"
                },
                "input_mode": {
                  "type": "string",
                  "description": "One of openclose -- each input controls one direction of motion, onebutton -- a single button press cycles through states: open, stop, close, stop ...",
                  "enum": [
                    "openclose",
                    "onebutton"
                  ]
                },
                "button_type": {
                  "type": "string",
                  "description": "One of momentary, toggle, detached or action",
                  "enum": [
                    "momentary",
                    "toggle",
                    "detached",
                    "action"
                  ]
                },
                "btn_reverse": {
                  "type": "number",
                  "description": "Whether to invert the state of input switch before interpreting it"
                },
                "state": {
                  "type": "string",
                  "description": "One of stop, open, close",
                  "enum": [
                    "stop",
                    "open",
                    "close"
                  ]
                },
                "power": {
                  "type": "number",
                  "description": "Current power consumption in Watts"
                },
                "is_valid": {
                  "type": "boolean",
                  "description": "If the power meter functions properly"
                },
                "safety_switch": {
                  "type": "boolean",
                  "description": "Whether the safety input is currently triggered"
                },
                "schedule": {
                  "type": "boolean",
                  "description": "Whether scheduling is enabled"
                },
                "schedule_rules": {
                  "type": "array",
                  "description": "Rules for schedule activation",
                  "items": {
                    "type": "string"
                  }
                },
                "obstacle_mode": {
                  "type": "string",
                  "description": "One of disabled, while_opening, while_closing, while_moving",
                  "enum": [
                    "disabled",
                    "while_opening",
                    "while_closing",
                    "while_moving"
                  ]
                },
                "obstacle_action": {
                  "type": "string",
                  "description": "One of stop, reverse",
                  "enum": [
                    "stop",
                    "reverse"
                  ]
                },
                "obstacle_power": {
                  "type": "number",
                  "description": "Power threshold for triggering 'obstacle' condition, Watts"
                },
                "obstacle_delay": {
                  "type": "number",
                  "description": "Number of seconds to wait after powering on the motor before obstacle detection is activated"
                },
                "ends_delay": {
                  "type": "number",
                  "description": "Period in ms after which the roller decides that it can't move anymore, 0-10000, with step of 100",
                  "minimum": 0,
                  "maximum": 10000,
                  "multipleOf": 100
                },
                "safety_mode": {
                  "type": "string",
                  "description": "One of disabled, while_opening, while_closing, while_moving",
                  "enum": [
                    "disabled",
                    "while_opening",
                    "while_closing",
                    "while_moving"
                  ]
                },
                "safety_action": {
                  "type": "string",
                  "description": "One of stop, pause, reverse",
                  "enum": [
                    "stop",
                    "pause",
                    "reverse"
                  ]
                },
                "safety_allowed_on_trigger": {
                  "type": "string",
                  "description": "Which commands are allowed while the safety switch is triggered: none, open, close, all",
                  "enum": [
                    "none",
                    "open",
                    "close",
                    "all"
                  ]
                },
                "off_power": {
                  "type": "number",
                  "description": "Power value below which the roller is considered 'stopped', i.e. the actuator is stopped by an end-stop switch"
                },
                "positioning": {
                  "type": "boolean",
                  "description": "Whether the device is calibrated for positioning control"
                }
              },
              "required": [
                "maxtime",
                "maxtime_open",
                "maxtime_close",
                "default_state",
                "swap",
                "swap_inputs",
                "input_mode",
                "button_type",
                "btn_reverse",
                "state",
                "power",
                "is_valid",
                "safety_switch",
                "schedule",
                "schedule_rules",
                "obstacle_mode",
                "obstacle_action",
                "obstacle_power",
                "obstacle_delay",
                "ends_delay",
                "safety_mode",
                "safety_action",
                "safety_allowed_on_trigger",
                "off_power",
                "positioning"
              ]
            }
          }
        },
        "required": [
          "rollers"
        ]
      }
    }
  ]
}